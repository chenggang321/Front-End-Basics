# 使用TypeScript两年后 - 值得吗？

差不多两年前，我在一个小型敏捷团队中开始了一个全新的项目。用到了Microservices，docker，react， redux， 所有那些花哨的东西。

我在类似的前端技术方面积累了一些经验，因为我去年花了20多名前端开发人员编写了一个非常大的反应应用程序。这对我来说非常具有挑战性。当时我们遇到了很多问题：模型内聚的问题，代码库的增长，复杂且难以维护的api，接口不一致，难以跟踪运行时异常。

在开始新项目之前，我决定找到解决这些问题的方法。我想也许我们有问题，因为语言本身有点过于弹性和宽容。您可以键入几乎所有内容，因为没有编译阶段，没有约束和运行前代码验证，您的包可能包含严重错误。

然后我遇到了Flowtype和TypeScript。经过短暂的评估后，我决定选择TypeScript，现在，两年后，我可以告诉你 - 这对项目和我的职业生涯来说是个不错的选择。但是，如果您认为TypeScript开发人员的生活是一片玫瑰花，那么您最好继续阅读。

在本文中，我不想详细说明TypeScripts的功能或深入了解项目设置。互联网上有很多很好的资源（例如官方TS文档：https：//www.typescriptlang.org/docs/home.html）。它也不是初学者的介绍。

这是一个关于TypeScript日常工作的好处和缺点的故事。我想描述一下我使用TypeScript的最糟糕体验，另一方面，我认为最有用的功能。这是关于利弊，权衡和利益，所以让我们开始吧。



首先要做的事 - 设置
正如我所提到的，我对react和redux有一些经验，所以我想利用它并在新项目中使用类似的（当然自定义）设置。通常的东西 - webpack，babel，npm脚本，开玩笑，linter。只需要一件小事 - TypeScript支持。

如果你现在处于类似情况 - 我可以向你保证：它不仅仅是webpack配置中的另一个加载器条目。我必须为TS提供专用配置，用TSLint替换ESLint，集成TypeScript加载器和babel，将TS插入Jest（测试平台）。

一些令人失望的事情发生得非常快。TS配置并不那么明显，“只是复制并测试”策略并不是准备性能良好的设置的最佳方法。

在将tsconfig.json放入项目之前，最好仔细阅读文档。

此外，Jest（转换，模块映射器）和css模块存在一些问题。可能你迟早会面对它们。并且不要认为，至少你现在可以放弃babel - TypeScript不会为你的新闪亮功能提供任何polyfill，也不会将你的新API转换为旧浏览器可以理解的代码。

所以我的建议是 - 如果可以的话，你应该使用一些入门套件或支持TS开箱即用的CLI（比如角度cli），以避免使用项目配置的无休止的故事。

图书馆支持
另一个非常不愉快的经历与TypeScript支持的库数量有关。

通常，当您是npm包的作者时，您可以随时使用有效的JavaScript包。有时，您还会公开包的ES6源代码。如果要为TypeScript准备库，则必须提供类型定义。简单来说 - 具有每个模块，命名空间，类，方法，函数等的声明的文件，可用于TypeScript使用者。TypeScript模块只能使用定义中描述的内容，并且只能以声明中指定的方式使用。不幸的是，通常源代码和声明之间没有严格的联系。它们可能不正确或过时。或者失踪。

就个人而言，我没有丢失声明的问题。大多数流行的图书馆都有自己的作者或社区准备的类型定义。如果您使用的包没有这样的文件 - 使用另一个，NPM注册表中有数十个包执行相同的操作。您还可以准备“虚拟”定义或创建真实定义并为开源社区做出贡献。

无论如何，还有一个更严重的问题 - 正如我之前提到的，一些声明是不正确的或过时的。如果你遇到这样的问题，没有简单的解决方案。您可以使用旧版本的软件包保留工作声明，自行修复并贡献或等待作者。有时候他们反应很快，有时却没有。

顺便说一句，我是一些简单包的作者，相信我，即使有良好的意愿，我也常常忘记将新功能与其类型定义同步。

日常工作
现在是好零件的时候了。一旦您配置了项目并选择了具有良好TS支持的库，就可以接受类型语言的强大功能了。如果你没有这种语言的背景，一开始可能有点奇怪。TypeScript中有许多功能在当前的JavaScript语法中找不到。让我们谈谈其中的一些，对我来说这是最有用的。

类型
不出所料，TS最常用的功能是静态类型。没有严格打字就没有使用TypeScript的意义。当然你可以使用宽容的“任何”类型，这意味着“我不关心那个东西的类型，它可能是一个数字，它可能是一个字符串数组，只是使用它”，但严重 - 更好的回去如果你想以这种方式编码，那就是好的旧JavaScript。

类型将帮助您更快，更安全地编码。您可以告诉编译器“此常量将指向一个数字”，如果您尝试将其用作数组或字符串，TS编译器将始终提示您输入错误。基本上，您仍然可以使用您的实体做任何您想做的事情，就像常规JavaScript一样，但现在您的操作比以前更安全，更易理解。

TypeScript中有几种基本类型，与它们相关的高级类型和技术很少。

下面你可以看到一些基本但非常强大的东西，对于更高级的类型，请访问文档：https：//www.typescriptlang.org/docs/handbook/advanced-types.html。



除了众所周知的类型，如数字或字符串，TypeScript还提供枚举。



您可以使用内置类型，如日期或错误。拥抱代码提示，以实现更快，更安全的编程。

接口
如果您认为类型是“游戏规则改变者”，那么您对接口有什么看法？接口可以帮助您编写更好的代码，因为它们最终允许您定义对象之间的契约。我创建了很多接口。他们无处不在。有时我有专门的文件，只是为了接口，因为他们应得的。

我主要用它来描述对象，类，函数和参数的形状。您可以在模块之间共享它们并像处理源代码中的实体一样对待，只需记住 - 运行时没有接口，有时很容易忘记它。这就是为什么有些情况下使用类而不是接口（如使用Angular Dependency Injection）更好。让我们看一下接口的一些真实例子：



在左边 - 返回类型的错误实现。在右侧 - VS代码立即通知您代码中的错误。



在左侧 - 一个类错误地实现了扩展用户界面的驱动程序接口（参见上一个屏幕）。在右边 - 解读性错误信息..

类
ES6中有类，所以你可能以前用过它们。但是在TypeScript类中有一些额外的功能，可能会出现在EcmaScript的未来实现中。在TS中，您可以定义抽象类，您可以将类属性描述为静态，私有或只读，您可以扩展类并使类实现接口（这是正确的！）。我不会描述TS类和ES6类之间的差异，因为在一天结束时它们都会产生类似的JavaScript代码（在编译和转换之后）。在TS类中，只是封装责任的优雅而有效的方式，它们与其他语言实现（如Java）非常相似，这会产生一些影响（更多关于“代码审查”部分的内容）。

当然，TypeScript中还有很多新东西，比如泛型（你会使用它们），枚举（有时可能，对于内部事物），名称空间，JSX支持等等。但你不必知道和使用它们一开始，只需使用上面提到的基本功能，您将看到，您的代码质量将得到提高。



使用TypeScript，您可以使用抽象类等功能。有关抽象类的更多信息：https：//www.typescriptlang.org/docs/handbook/classes.html



TypeScript支持private，public和protected方法，只读属性。类可以实现接口或扩展其他类。

代码质量
我刚才提到了代码质量吗？当然我做了，因为我们都关心代码质量（以及客户需求，截止日期和估计，以及...）。

那么为什么要使用TypeScript（在代码质量的上下文中）呢？

代码中没有与参数或变量名称中的拼写错误相关的一些非常烦人的运行时错误
您可以在对象之间建立清晰且众所周知的契约
没有黑客可以实现像私人班级成员这样的事情
有来自编译器的即时反馈，很多错误都是在编译阶段捕获的，而不是在运行时
非JS开发人员更容易阅读和理解代码
您可以使用未来版本的JavaScript中的功能
为单元测试编写模拟，存根和伪装要容易得多，因为你知道他们的确切接口
此外，由于出色的IDE支持，编写可维护代码要容易得多。老实说 - 即使你在中小型应用程序上独自工作，几周后你也不会记得你必须传递给服务的论点类型或新创建用户的形状。您可以访问源代码，检查代码并提取有价值的信息（因为您的代码总是干净且快速阅读），但将鼠标悬停在您喜欢的编辑器中的函数名称上并不是更好，例如，它接受“年龄”，这是一个“数字”，并返回具有“年龄”和“名称”属性的用户实例？

代码审查是我想提到的另一件事。当你在小团队中工作时，有时候你是唯一的前端开发人员，你的.net或Java的团队成员真的不喜欢查看vanilla JavaScript。由于语言的动态和简洁性，它对他们来说不太可读。没有类型意味着没有提示。例如 - 名称为“user”的对象具有“ID”属性，但它是数字还是字符串？如果是一个字符串，为什么你只需要调用“toString（）”就可以了？如果一个数字，为​​什么你刚刚在它前面添加字符串“id_”呢？TypeScript代码看起来很像其他流行的类型语言，并且有可能您将获得更好，更准确的代码审查。更好的代码审查意味着更好的代码。期。



在左侧 - TypeScript中的代码。在右边 - Java中的代码。如您所见，语法非常相似，这意味着您的代码应该比Java开发人员更容易理解。

学习曲线
哦，最后我还有一个关于TypeScript的话。与往常一样，当您尝试新事物时，会有一些学习曲线。在TS的情况下，它不是非常陡峭，而是足够陡峭，以避免从TypeScript和新框架开始。特别是在大型或缺乏经验的团队中。这就是为什么我两年前为我的第一个TS应用程序选择了这个项目 - 我非常了解堆栈，所以这是一个很好的机会学习一种有前途的语言。我很确定，如果我同时选择了一个新框架（让我们说Angular）和一种新语言，我会更加失望和沮丧。

摘要
我会向你推荐TypeScript吗？我当然会。它将帮助您在更短的时间内提供更好的代码。IDE支持现在非常棒，社区充满活力，具有TS定义的库的数量足够大且不断增长，程序员经验（来自编译器的快速反馈）令人满意。这是我所知道的用于创建现代和可扩展的Web应用程序（以及Node.js服务！）的最佳工具。请记住上面提到的一些缺点，处理它们并深入探索静态类型语言的多彩世界。